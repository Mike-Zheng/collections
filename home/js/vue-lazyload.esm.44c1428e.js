/*!
 * Vue-Lazyload.js v1.3.4
 * (c) 2021 Awe <hilongjw@gmail.com>
 * Released under the MIT License.
 *//*!
 * is-primitive <https://github.com/jonschlinkert/is-primitive>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var L=function(i){return i==null||typeof i!="function"&&typeof i!="object"},I=Object.freeze({__proto__:null,default:L,__moduleExports:L});/*!
 * assign-symbols <https://github.com/jonschlinkert/assign-symbols>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var _=function(r,i){if(r===null||typeof r=="undefined")throw new TypeError("expected first argument to be an object.");if(typeof i=="undefined"||typeof Symbol=="undefined"||typeof Object.getOwnPropertySymbols!="function")return r;for(var t=Object.prototype.propertyIsEnumerable,e=Object(r),n=arguments.length,s=0;++s<n;)for(var o=Object(arguments[s]),a=Object.getOwnPropertySymbols(o),h=0;h<a.length;h++){var d=a[h];t.call(o,d)&&(e[d]=o[d])}return e},$=Object.freeze({__proto__:null,default:_,__moduleExports:_}),W=Object.prototype.toString,E=function(i){var t=typeof i;return t==="undefined"?"undefined":i===null?"null":i===!0||i===!1||i instanceof Boolean?"boolean":t==="string"||i instanceof String?"string":t==="number"||i instanceof Number?"number":t==="function"||i instanceof Function?typeof i.constructor.name!="undefined"&&i.constructor.name.slice(0,9)==="Generator"?"generatorfunction":"function":typeof Array.isArray!="undefined"&&Array.isArray(i)?"array":i instanceof RegExp?"regexp":i instanceof Date?"date":(t=W.call(i),t==="[object RegExp]"?"regexp":t==="[object Date]"?"date":t==="[object Arguments]"?"arguments":t==="[object Error]"?"error":t==="[object Promise]"?"promise":U(i)?"buffer":t==="[object Set]"?"set":t==="[object WeakSet]"?"weakset":t==="[object Map]"?"map":t==="[object WeakMap]"?"weakmap":t==="[object Symbol]"?"symbol":t==="[object Map Iterator]"?"mapiterator":t==="[object Set Iterator]"?"setiterator":t==="[object String Iterator]"?"stringiterator":t==="[object Array Iterator]"?"arrayiterator":t==="[object Int8Array]"?"int8array":t==="[object Uint8Array]"?"uint8array":t==="[object Uint8ClampedArray]"?"uint8clampedarray":t==="[object Int16Array]"?"int16array":t==="[object Uint16Array]"?"uint16array":t==="[object Int32Array]"?"int32array":t==="[object Uint32Array]"?"uint32array":t==="[object Float32Array]"?"float32array":t==="[object Float64Array]"?"float64array":"object")};function U(r){return r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}var S=Object.freeze({__proto__:null,default:E,__moduleExports:E}),N=I&&L||I,F=$&&_||$,v=S&&E||S;function R(r){r=r||{};var i=arguments.length,t=0;if(i===1)return r;for(;++t<i;){var e=arguments[t];N(r)&&(r=e),H(e)&&q(r,e)}return r}function q(r,i){F(r,i);for(var t in i)if(K(t)&&G(i,t)){var e=i[t];H(e)?(v(r[t])==="undefined"&&v(e)==="function"&&(r[t]=e),r[t]=R(r[t]||{},e)):r[t]=e}return r}function H(r){return v(r)==="object"||v(r)==="function"}function G(r,i){return Object.prototype.hasOwnProperty.call(r,i)}function K(r){return r!=="__proto__"&&r!=="constructor"&&r!=="prototype"}var y=R;const f=typeof window!="undefined"&&window!==null,C=V();function V(){return f&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}}),!0):!1}const p={event:"event",observer:"observer"},M=function(){if(!f)return;if(typeof window.CustomEvent=="function")return window.CustomEvent;function r(i,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");return e.initCustomEvent(i,t.bubbles,t.cancelable,t.detail),e}return r.prototype=window.Event.prototype,r}();function m(r,i){if(!r.length)return;const t=r.indexOf(i);if(t>-1)return r.splice(t,1)}function J(r,i){let t=!1;for(let e=0,n=r.length;e<n;e++)if(i(r[e])){t=!0;break}return t}function T(r,i){if(r.tagName!=="IMG"||!r.getAttribute("data-srcset"))return;let t=r.getAttribute("data-srcset");const e=[],s=r.parentNode.offsetWidth*i;let o,a,h;t=t.trim().split(","),t.map(l=>{l=l.trim(),o=l.lastIndexOf(" "),o===-1?(a=l,h=999998):(a=l.substr(0,o),h=parseInt(l.substr(o+1,l.length-o-2),10)),e.push([h,a])}),e.sort(function(l,u){if(l[0]<u[0])return 1;if(l[0]>u[0])return-1;if(l[0]===u[0]){if(u[1].indexOf(".webp",u[1].length-5)!==-1)return 1;if(l[1].indexOf(".webp",l[1].length-5)!==-1)return-1}return 0});let d="",c;for(let l=0;l<e.length;l++){c=e[l],d=c[1];const u=e[l+1];if(u&&u[0]<s){d=c[1];break}else if(!u){d=c[1];break}}return d}function g(r,i){let t;for(let e=0,n=r.length;e<n;e++)if(i(r[e])){t=r[e];break}return t}const X=(r=1)=>f&&window.devicePixelRatio||r;function Y(){if(!f)return!1;let r=!0;try{const i=document.createElement("canvas");i.getContext&&i.getContext("2d")&&(r=i.toDataURL("image/webp").indexOf("data:image/webp")===0)}catch(i){r=!1}return r}function Z(r,i){let t=null,e=null,n=0,s=!1;return function(){if(s=!0,t)return;let o=Date.now()-n,a=this,h=arguments,d=function(){n=Date.now(),t=!1,r.apply(a,h)};o>=i?d():t=setTimeout(d,i),s&&(clearTimeout(e),e=setTimeout(d,2*i))}}function tt(){if(!f)return;let r=!1;try{let i=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("test",null,i)}catch(i){}return r}const et=tt(),rt={on(r,i,t,e=!1){et?r.addEventListener(i,t,{capture:e,passive:!0}):r.addEventListener(i,t,e)},off(r,i,t,e=!1){r.removeEventListener(i,t,e)}},A=(r,i,t)=>{let e=new Image;if(!r||!r.src){const n=new Error("image src is required");return t(n)}e.src=r.src,r.cors&&(e.crossOrigin=r.cors),e.onload=function(){i({naturalHeight:e.naturalHeight,naturalWidth:e.naturalWidth,src:e.src})},e.onerror=function(n){t(n)}},w=(r,i)=>typeof getComputedStyle!="undefined"?getComputedStyle(r,null).getPropertyValue(i):r.style[i],it=r=>w(r,"overflow")+w(r,"overflow-y")+w(r,"overflow-x"),nt=r=>{if(!f)return;if(!(r instanceof HTMLElement))return window;let i=r;for(;i&&!(i===document.body||i===document.documentElement||!i.parentNode);){if(/(scroll|auto)/.test(it(i)))return i;i=i.parentNode}return window};function st(r){return r!==null&&typeof r=="object"}function ot(r){if(!(r instanceof Object))return[];if(Object.keys)return Object.keys(r);{let i=[];for(let t in r)r.hasOwnProperty(t)&&i.push(t);return i}}function at(r){let i=r.length;const t=[];for(let e=0;e<i;e++)t.push(r[e]);return t}function Q(){}class dt{constructor({max:i}){this.options={max:i||100},this._caches=[]}has(i){return this._caches.indexOf(i)>-1}add(i){this.has(i)||(this._caches.push(i),this._caches.length>this.options.max&&this.free())}free(){this._caches.shift()}}class lt{constructor({el:i,src:t,error:e,loading:n,bindType:s,$parent:o,options:a,cors:h,elRenderer:d,imageCache:c}){this.el=i,this.src=t,this.error=e,this.loading=n,this.bindType=s,this.attempt=0,this.cors=h,this.naturalHeight=0,this.naturalWidth=0,this.options=a,this.rect=null,this.$parent=o,this.elRenderer=d,this._imageCache=c,this.performanceData={init:Date.now(),loadStart:0,loadEnd:0},this.filter(),this.initState(),this.render("loading",!1)}initState(){"dataset"in this.el?this.el.dataset.src=this.src:this.el.setAttribute("data-src",this.src),this.state={loading:!1,error:!1,loaded:!1,rendered:!1}}record(i){this.performanceData[i]=Date.now()}update({src:i,loading:t,error:e}){const n=this.src;this.src=i,this.loading=t,this.error=e,this.filter(),n!==this.src&&(this.attempt=0,this.initState())}getRect(){this.rect=this.el.getBoundingClientRect()}checkInView(){return this.getRect(),this.rect.top<window.innerHeight*this.options.preLoad&&this.rect.bottom>this.options.preLoadTop&&this.rect.left<window.innerWidth*this.options.preLoad&&this.rect.right>0}filter(){ot(this.options.filter).map(i=>{this.options.filter[i](this,this.options)})}renderLoading(i){this.state.loading=!0,A({src:this.loading,cors:this.cors},t=>{this.render("loading",!1),this.state.loading=!1,i()},()=>{i(),this.state.loading=!1,this.options.silent||console.warn(`VueLazyload log: load failed with loading image(${this.loading})`)})}load(i=Q){if(this.attempt>this.options.attempt-1&&this.state.error){this.options.silent||console.log(`VueLazyload log: ${this.src} tried too more than ${this.options.attempt} times`),i();return}if(!(this.state.rendered&&this.state.loaded)){if(this._imageCache.has(this.src))return this.state.loaded=!0,this.render("loaded",!0),this.state.rendered=!0,i();this.renderLoading(()=>{this.attempt++,this.options.adapter.beforeLoad&&this.options.adapter.beforeLoad(this,this.options),this.record("loadStart"),A({src:this.src,cors:this.cors},t=>{this.naturalHeight=t.naturalHeight,this.naturalWidth=t.naturalWidth,this.state.loaded=!0,this.state.error=!1,this.record("loadEnd"),this.render("loaded",!1),this.state.rendered=!0,this._imageCache.add(this.src),i()},t=>{!this.options.silent&&console.error(t),this.state.error=!0,this.state.loaded=!1,this.render("error",!1)})})}}render(i,t){this.elRenderer(this,i,t)}performance(){let i="loading",t=0;return this.state.loaded&&(i="loaded",t=(this.performanceData.loadEnd-this.performanceData.loadStart)/1e3),this.state.error&&(i="error"),{src:this.src,state:i,time:t}}$destroy(){this.el=null,this.src=null,this.error=null,this.loading=null,this.bindType=null,this.attempt=0}}const j="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",ht=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],ct={rootMargin:"0px",threshold:0};function b(r){return class{constructor({preLoad:t,error:e,throttleWait:n,preLoadTop:s,dispatchEvent:o,loading:a,attempt:h,silent:d=!0,scale:c,listenEvents:l,hasbind:u,filter:B,adapter:D,observer:P,observerOptions:k}){this.version='"1.3.4"',this.mode=p.event,this.ListenerQueue=[],this.TargetIndex=0,this.TargetQueue=[],this.options={silent:d,dispatchEvent:!!o,throttleWait:n||200,preLoad:t||1.3,preLoadTop:s||0,error:e||j,loading:a||j,attempt:h||3,scale:c||X(c),ListenEvents:l||ht,hasbind:!1,supportWebp:Y(),filter:B||{},adapter:D||{},observer:!!P,observerOptions:k||ct},this._initEvent(),this._imageCache=new dt({max:200}),this.lazyLoadHandler=Z(this._lazyLoadHandler.bind(this),this.options.throttleWait),this.setMode(this.options.observer?p.observer:p.event)}config(t={}){y(this.options,t)}performance(){let t=[];return this.ListenerQueue.map(e=>{t.push(e.performance())}),t}addLazyBox(t){this.ListenerQueue.push(t),f&&(this._addListenerTarget(window),this._observer&&this._observer.observe(t.el),t.$el&&t.$el.parentNode&&this._addListenerTarget(t.$el.parentNode))}add(t,e,n){if(J(this.ListenerQueue,d=>d.el===t))return this.update(t,e),r.nextTick(this.lazyLoadHandler);let{src:s,loading:o,error:a,cors:h}=this._valueFormatter(e.value);r.nextTick(()=>{s=T(t,this.options.scale)||s,this._observer&&this._observer.observe(t);const d=Object.keys(e.modifiers)[0];let c;d&&(c=n.context.$refs[d],c=c?c.$el||c:document.getElementById(d)),c||(c=nt(t));const l=new lt({bindType:e.arg,$parent:c,el:t,loading:o,error:a,src:s,cors:h,elRenderer:this._elRenderer.bind(this),options:this.options,imageCache:this._imageCache});this.ListenerQueue.push(l),f&&(this._addListenerTarget(window),this._addListenerTarget(c)),this.lazyLoadHandler(),r.nextTick(()=>this.lazyLoadHandler())})}update(t,e,n){let{src:s,loading:o,error:a}=this._valueFormatter(e.value);s=T(t,this.options.scale)||s;const h=g(this.ListenerQueue,d=>d.el===t);h?h.update({src:s,loading:o,error:a}):this.add(t,e,n),this._observer&&(this._observer.unobserve(t),this._observer.observe(t)),this.lazyLoadHandler(),r.nextTick(()=>this.lazyLoadHandler())}remove(t){if(!t)return;this._observer&&this._observer.unobserve(t);const e=g(this.ListenerQueue,n=>n.el===t);e&&(this._removeListenerTarget(e.$parent),this._removeListenerTarget(window),m(this.ListenerQueue,e),e.$destroy())}removeComponent(t){!t||(m(this.ListenerQueue,t),this._observer&&this._observer.unobserve(t.el),t.$parent&&t.$el.parentNode&&this._removeListenerTarget(t.$el.parentNode),this._removeListenerTarget(window))}setMode(t){!C&&t===p.observer&&(t=p.event),this.mode=t,t===p.event?(this._observer&&(this.ListenerQueue.forEach(e=>{this._observer.unobserve(e.el)}),this._observer=null),this.TargetQueue.forEach(e=>{this._initListen(e.el,!0)})):(this.TargetQueue.forEach(e=>{this._initListen(e.el,!1)}),this._initIntersectionObserver())}_addListenerTarget(t){if(!t)return;let e=g(this.TargetQueue,n=>n.el===t);return e?e.childrenCount++:(e={el:t,id:++this.TargetIndex,childrenCount:1,listened:!0},this.mode===p.event&&this._initListen(e.el,!0),this.TargetQueue.push(e)),this.TargetIndex}_removeListenerTarget(t){this.TargetQueue.forEach((e,n)=>{e.el===t&&(e.childrenCount--,e.childrenCount||(this._initListen(e.el,!1),this.TargetQueue.splice(n,1),e=null))})}_initListen(t,e){this.options.ListenEvents.forEach(n=>rt[e?"on":"off"](t,n,this.lazyLoadHandler))}_initEvent(){this.Event={listeners:{loading:[],loaded:[],error:[]}},this.$on=(t,e)=>{this.Event.listeners[t]||(this.Event.listeners[t]=[]),this.Event.listeners[t].push(e)},this.$once=(t,e)=>{const n=this;function s(){n.$off(t,s),e.apply(n,arguments)}this.$on(t,s)},this.$off=(t,e)=>{if(!e){if(!this.Event.listeners[t])return;this.Event.listeners[t].length=0;return}m(this.Event.listeners[t],e)},this.$emit=(t,e,n)=>{!this.Event.listeners[t]||this.Event.listeners[t].forEach(s=>s(e,n))}}_lazyLoadHandler(){const t=[];this.ListenerQueue.forEach((e,n)=>{(!e.el||!e.el.parentNode)&&t.push(e),e.checkInView()&&e.load()}),t.forEach(e=>{m(this.ListenerQueue,e),e.$destroy()})}_initIntersectionObserver(){!C||(this._observer=new IntersectionObserver(this._observerHandler.bind(this),this.options.observerOptions),this.ListenerQueue.length&&this.ListenerQueue.forEach(t=>{this._observer.observe(t.el)}))}_observerHandler(t,e){t.forEach(n=>{n.isIntersecting&&this.ListenerQueue.forEach(s=>{if(s.el===n.target){if(s.state.loaded)return this._observer.unobserve(s.el);s.load()}})})}_elRenderer(t,e,n){if(!t.el)return;const{el:s,bindType:o}=t;let a;switch(e){case"loading":a=t.loading;break;case"error":a=t.error;break;default:a=t.src;break}if(o?s.style[o]='url("'+a+'")':s.getAttribute("src")!==a&&s.setAttribute("src",a),s.setAttribute("lazy",e),this.$emit(e,t,n),this.options.adapter[e]&&this.options.adapter[e](t,this.options),this.options.dispatchEvent){const h=new M(e,{detail:t});s.dispatchEvent(h)}}_valueFormatter(t){let e=t,n=this.options.loading,s=this.options.error;return st(t)&&(!t.src&&!this.options.silent&&console.error("Vue Lazyload warning: miss src with "+t),e=t.src,n=t.loading||this.options.loading,s=t.error||this.options.error),{src:e,loading:n,error:s}}}}b.install=(r,i={})=>{const t=b(r),e=new t(i);r.version.split(".")[0]==="2"?r.directive("lazy",{bind:e.add.bind(e),update:e.update.bind(e),componentUpdated:e.lazyLoadHandler.bind(e),unbind:e.remove.bind(e)}):r.directive("lazy",{bind:e.lazyLoadHandler.bind(e),update(s,o){y(this.vm.$refs,this.vm.$els),e.add(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:s,oldValue:o},{context:this.vm})},unbind(){e.remove(this.el)}})};const z=r=>({props:{tag:{type:String,default:"div"}},render(i){return i(this.tag,null,this.show?this.$slots.default:null)},data(){return{el:null,state:{loaded:!1},rect:{},show:!1}},mounted(){this.el=this.$el,r.addLazyBox(this),r.lazyLoadHandler()},beforeDestroy(){r.removeComponent(this)},methods:{getRect(){this.rect=this.$el.getBoundingClientRect()},checkInView(){return this.getRect(),f&&this.rect.top<window.innerHeight*r.options.preLoad&&this.rect.bottom>0&&this.rect.left<window.innerWidth*r.options.preLoad&&this.rect.right>0},load(){this.show=!0,this.state.loaded=!0,this.$emit("show",this)},destroy(){return this.$destroy}}});z.install=function(r,i={}){const t=b(r),e=new t(i);r.component("lazy-component",z(e))};class ut{constructor({lazy:i}){this.lazy=i,i.lazyContainerMananger=this,this._queue=[]}bind(i,t,e){const n=new O({el:i,binding:t,vnode:e,lazy:this.lazy});this._queue.push(n)}update(i,t,e){const n=g(this._queue,s=>s.el===i);!n||n.update({el:i,binding:t,vnode:e})}unbind(i,t,e){const n=g(this._queue,s=>s.el===i);!n||(n.clear(),m(this._queue,n))}}const ft={selector:"img"};class O{constructor({el:i,binding:t,vnode:e,lazy:n}){this.el=null,this.vnode=e,this.binding=t,this.options={},this.lazy=n,this._queue=[],this.update({el:i,binding:t})}update({el:i,binding:t}){this.el=i,this.options=y({},ft,t.value),this.getImgs().forEach(n=>{this.lazy.add(n,y({},this.binding,{value:{src:"dataset"in n?n.dataset.src:n.getAttribute("data-src"),error:("dataset"in n?n.dataset.error:n.getAttribute("data-error"))||this.options.error,loading:("dataset"in n?n.dataset.loading:n.getAttribute("data-loading"))||this.options.loading}}),this.vnode)})}getImgs(){return at(this.el.querySelectorAll(this.options.selector))}clear(){this.getImgs().forEach(t=>this.lazy.remove(t)),this.vnode=null,this.binding=null,this.lazy=null}}O.install=(r,i={})=>{const t=b(r),e=new t(i),n=new O({lazy:e});r.version.split(".")[0]==="2"?r.directive("lazy-container",{bind:n.bind.bind(n),componentUpdated:n.update.bind(n),unbind:n.unbind.bind(n)}):r.directive("lazy-container",{update(o,a){n.update(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:o,oldValue:a},{context:this.vm})},unbind(){n.unbind(this.el)}})};const x=r=>({props:{src:[String,Object],tag:{type:String,default:"img"}},render(i){return i(this.tag,{attrs:{src:this.renderSrc}},this.$slots.default)},data(){return{el:null,options:{src:"",error:"",loading:"",attempt:r.options.attempt},state:{loaded:!1,error:!1,attempt:0},rect:{},renderSrc:""}},watch:{src(){this.init(),r.addLazyBox(this),r.lazyLoadHandler()}},created(){this.init(),this.renderSrc=this.options.loading},mounted(){this.el=this.$el,r.addLazyBox(this),r.lazyLoadHandler()},beforeDestroy(){r.removeComponent(this)},methods:{init(){const{src:i,loading:t,error:e}=r._valueFormatter(this.src);this.state.loaded=!1,this.options.src=i,this.options.error=e,this.options.loading=t,this.renderSrc=this.options.loading},getRect(){this.rect=this.$el.getBoundingClientRect()},checkInView(){return this.getRect(),f&&this.rect.top<window.innerHeight*r.options.preLoad&&this.rect.bottom>0&&this.rect.left<window.innerWidth*r.options.preLoad&&this.rect.right>0},load(i=Q){if(this.state.attempt>this.options.attempt-1&&this.state.error){r.options.silent||console.log(`VueLazyload log: ${this.options.src} tried too more than ${this.options.attempt} times`),i();return}const t=this.options.src;A({src:t},({src:e})=>{this.renderSrc=e,this.state.loaded=!0},e=>{this.state.attempt++,this.renderSrc=this.options.error,this.state.error=!0})}}});x.install=(r,i={})=>{const t=b(r),e=new t(i);r.component("lazy-image",x(e))};var bt={install(r,i={}){const t=b(r),e=new t(i),n=new ut({lazy:e}),s=r.version.split(".")[0]==="2";r.prototype.$Lazyload=e,i.lazyComponent&&r.component("lazy-component",z(e)),i.lazyImage&&r.component("lazy-image",x(e)),s?(r.directive("lazy",{bind:e.add.bind(e),update:e.update.bind(e),componentUpdated:e.lazyLoadHandler.bind(e),unbind:e.remove.bind(e)}),r.directive("lazy-container",{bind:n.bind.bind(n),componentUpdated:n.update.bind(n),unbind:n.unbind.bind(n)})):(r.directive("lazy",{bind:e.lazyLoadHandler.bind(e),update(o,a){y(this.vm.$refs,this.vm.$els),e.add(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:o,oldValue:a},{context:this.vm})},unbind(){e.remove(this.el)}}),r.directive("lazy-container",{update(o,a){n.update(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:o,oldValue:a},{context:this.vm})},unbind(){n.unbind(this.el)}}))}};export{bt as i};
